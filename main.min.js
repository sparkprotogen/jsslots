var doing=!1,spin=[new Audio("src/sounds/spin.mp3"),new Audio("src/sounds/spin.mp3"),new Audio("src/sounds/spin.mp3"),new Audio("src/sounds/spin.mp3"),new Audio("src/sounds/spin.mp3"),new Audio("src/sounds/spin.mp3"),new Audio("src/sounds/spin.mp3")],coin=[new Audio("src/sounds/coin.mp3"),new Audio("src/sounds/coin.mp3"),new Audio("src/sounds/coin.mp3")],win=new Audio("src/sounds/win.mp3"),lose=new Audio("src/sounds/lose.mp3"),audio=!1;let status=document.getElementById("status"),text=document.getElementById("text"),confe=document.querySelector("#my-canvas");var wins_element=document.getElementById("wins"),score_element=document.getElementById("score"),userName=document.getElementById("userName").textContent,blinkId=0,blink=!1,score=0,wins=0,id=0;const firebaseConfig={apiKey:"AIzaSyDrx_IMLOUSSRAKHSh3nT7HABzjPtv0bI4",authDomain:"slot-game-8aed2.firebaseapp.com",projectId:"slot-game-8aed2",storageBucket:"slot-game-8aed2.appspot.com",messagingSenderId:"1003739740685",appId:"1:1003739740685:web:26755aeb50afdce1cc3344"};function doSlot(){if(0!=blinkId&&clearInterval(blinkId),confe.classList.remove("active"),doing)return null;doing=!0;var e=7*randomInt(1,4),n=e+randomInt(1,7),s=e+14+randomInt(1,7),t=e+28+randomInt(1,7),a=0,o=0,i=0,l=0;text.style="visibility: visible",text.innerHTML="SPINNING...",status.style.background="#606060",document.getElementById("body").style.background="#0f0f0f",slot1=setInterval(function(){if(++a>=n)return coin[0].play(),clearInterval(slot1),null;slotTile=document.getElementById("slot1"),"a7"==slotTile.className&&(slotTile.className="a0");slotTile.className="a"+(parseInt(slotTile.className.substring(1))+1)},50),slot2=setInterval(function(){if(++o>=s)return coin[1].play(),clearInterval(slot2),null;slotTile=document.getElementById("slot2"),"a7"==slotTile.className&&(slotTile.className="a0");slotTile.className="a"+(parseInt(slotTile.className.substring(1))+1)},50),slot3=setInterval(function(){if(++i>=t)return coin[2].play(),clearInterval(slot3),testWin(),null;slotTile=document.getElementById("slot3"),"a7"==slotTile.className&&(slotTile.className="a0");++l==spin.length&&(l=0);spin[l].play(),slotTile.className="a"+(parseInt(slotTile.className.substring(1))+1)},50)}function testWin(){var e=document.getElementById("slot1").className,n=document.getElementById("slot2").className,s=document.getElementById("slot3").className;e==n&&n==s||e==n&&"a7"==s||e==s&&"a7"==n||n==s&&"a7"==e||e==n&&"a7"==e||e==s&&"a7"==e||n==s&&"a7"==n?(e==n&&n==s&&"a7"!=e&&"a7"!=n&&"a7"!=s?(text.innerHTML="BIG WIN!",addWin(500)):"a7"==e&&"a7"==n&&"a7"==s?(text.innerHTML="JACKPOT!",addWin(1e3)):(text.innerHTML="YOU WIN!",addWin(100)),status.style.background="#3e962aa9",document.getElementById("body").style.background="#162511",confeti(),win.play(),blinkId=setInterval(blinkText,500)):(text.innerHTML="YOU LOSE!",status.style.background="#962a2aa9",document.getElementById("body").style.background="#251111",lose.play()),doing=!1}function main(){toggleAudio(),leaderboardScores()}function toggleAudio(){if(audio){for(var e of(audio=!audio,spin))e.volume=0;for(var e of coin)e.volume=0;win.volume=0,lose.volume=0}else{for(var e of(audio=!audio,spin))e.volume=.5;for(var e of coin)e.volume=.5;win.volume=1,lose.volume=1}document.getElementById("audio").src="src/icons/audio"+(audio?"On":"Off")+".png"}function randomInt(e,n){return Math.floor(Math.random()*(n-e+1)+e)}function updateWins(){1==login&&(firebase.database().ref("Users/"+id+"/data/wins").once("value",e=>{null!=e.val()?(wins=parseInt(e.val()),wins_element.innerHTML="Wins: "+wins.toString()):(wins=0,firebase.database().ref("Users/"+id+"/data").set({score:0,wins:0}))}),firebase.database().ref("Users/"+id+"/data/score").once("value",e=>{null!=e.val()?(score=parseInt(e.val()),score_element.innerHTML="Score: "+score.toString()):(score=0,firebase.database().ref("Users/"+id+"/data").set({score:0,wins:0}),firebase.database().ref("scores/"+userName+"-"+id).set({score:0}))}))}function addWin(e){1==login&&(firebase.database().ref("Users/"+id+"/data").set({score:score+e,wins:wins+1}),firebase.database().ref("scores/"+userName+"-"+id).set({score:score+e}),updateWins())}function confeti(){new ConfettiGenerator({target:"my-canvas"}).render(),confe.classList.add("active")}function blinkText(){text.style=blink?"visibility: hidden":"visibility: visible",blink=!blink}function leaderboardScores(){var e=firebase.database().ref("/scores").orderByChild("score").limitToLast(10),n=new Array;e.once("value",function(e){e.forEach(function(e){var s=e.key.split("-")[0];n.push([s,e.val().score])});var s=[];n=n.reverse();for(var t=0;t<10;t++)s[t]=document.getElementById("score"+(t+1).toString()),s[t].innerText=n[t][0]+": "+n[t][1]})}firebase.initializeApp(firebaseConfig),firebase.auth().onAuthStateChanged(e=>{e?(login=!0,id=firebase.auth().currentUser.uid,userName=e.displayName,console.log(userName),updateWins()):(login=!1,score_element.innerHTML="Score: 0",wins_element.innerHTML="Wins: 0")}),window.addEventListener("keydown",e=>{"Space"==e.code&&doSlot()});